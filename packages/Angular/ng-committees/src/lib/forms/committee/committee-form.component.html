<!--
  mj-record-form-container: Wrapper that provides the form toolbar
  (Save, Cancel, Delete buttons) and handles form submission
-->
<mj-record-form-container [record]="record" [formComponent]="this">

    <!-- ==================== FIELD PANELS ==================== -->
    <!-- slot="field-panels" puts this section in the main form area -->

    <!-- Basic Information Section -->
    <mj-collapsible-panel
        slot="field-panels"
        sectionKey="basicInformation"
        sectionName="Basic Information"
        icon="fa fa-info-circle"
        [form]="this"
        [formContext]="formContext">

        <!--
          mj-form-field: Smart field component that renders the right input type
          based on the field's data type (text, dropdown, date, etc.)
        -->
        <mj-form-field
            [record]="record"
            [ShowLabel]="true"
            FieldName="Name"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext">
        </mj-form-field>

        <mj-form-field
            [record]="record"
            [ShowLabel]="true"
            FieldName="Description"
            Type="textarea"
            [EditMode]="EditMode"
            [formContext]="formContext">
        </mj-form-field>

        <!--
          LinkType="Record" makes this a lookup field that links to another entity
          LinkComponentType="Search" shows a searchable dropdown
        -->
        <mj-form-field
            [record]="record"
            [ShowLabel]="true"
            FieldName="TypeID"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
            LinkType="Record"
            LinkComponentType="Search">
        </mj-form-field>

        <mj-form-field
            [record]="record"
            [ShowLabel]="true"
            FieldName="MissionStatement"
            Type="textarea"
            [EditMode]="EditMode"
            [formContext]="formContext">
        </mj-form-field>
    </mj-collapsible-panel>

    <!-- Hierarchy & Organization Section -->
    <mj-collapsible-panel
        slot="field-panels"
        sectionKey="hierarchyOrganization"
        sectionName="Hierarchy & Organization"
        icon="fa fa-sitemap"
        [form]="this"
        [formContext]="formContext">

        <mj-form-field
            [record]="record"
            [ShowLabel]="true"
            FieldName="ParentCommitteeID"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext"
            LinkType="Record"
            LinkComponentType="Search">
        </mj-form-field>

        <mj-form-field
            [record]="record"
            [ShowLabel]="true"
            FieldName="IsPublic"
            Type="checkbox"
            [EditMode]="EditMode"
            [formContext]="formContext">
        </mj-form-field>

        <mj-form-field
            [record]="record"
            [ShowLabel]="true"
            FieldName="CharterDocumentURL"
            Type="textbox"
            [EditMode]="EditMode"
            [formContext]="formContext">
        </mj-form-field>
    </mj-collapsible-panel>

    <!-- Lifecycle Section -->
    <mj-collapsible-panel
        slot="field-panels"
        sectionKey="lifecycle"
        sectionName="Lifecycle"
        icon="fa fa-clock"
        [form]="this"
        [formContext]="formContext">

        <mj-form-field
            [record]="record"
            [ShowLabel]="true"
            FieldName="Status"
            Type="dropdownlist"
            [EditMode]="EditMode"
            [formContext]="formContext">
        </mj-form-field>

        <mj-form-field
            [record]="record"
            [ShowLabel]="true"
            FieldName="FormationDate"
            Type="datepicker"
            [EditMode]="EditMode"
            [formContext]="formContext">
        </mj-form-field>

        <mj-form-field
            [record]="record"
            [ShowLabel]="true"
            FieldName="DissolutionDate"
            Type="datepicker"
            [EditMode]="EditMode"
            [formContext]="formContext">
        </mj-form-field>
    </mj-collapsible-panel>

    <!-- ==================== RELATED ENTITY PANELS ==================== -->
    <!-- slot="after-panels" puts these sections after the main form fields -->

    <!-- Memberships Grid -->
    <mj-collapsible-panel
        slot="after-panels"
        sectionKey="memberships"
        sectionName="Memberships"
        icon="fa fa-users"
        variant="related-entity"
        [form]="this"
        [formContext]="formContext"
        [badgeCount]="GetSectionRowCount('memberships')"
        [defaultExpanded]="false">

        <!-- Only show grid if the record has been saved (has an ID) -->
        <div *ngIf="record.IsSaved">
            <!--
              mj-explorer-entity-data-grid: Shows related records in an editable grid

              BuildRelationshipViewParamsByEntityName: Helper that creates the filter
              to show only Memberships where CommitteeID matches this committee

              NewRecordValues: When user creates new record in grid, auto-fill CommitteeID
            -->
            <mj-explorer-entity-data-grid
                [Params]="BuildRelationshipViewParamsByEntityName('Memberships','CommitteeID')"
                [NewRecordValues]="NewRecordValues('Memberships')"
                [AllowLoad]="IsSectionExpanded('memberships')"
                [ShowToolbar]="false"
                (AfterDataLoad)="SetSectionRowCount('memberships', $event.totalRowCount)">
            </mj-explorer-entity-data-grid>
        </div>
    </mj-collapsible-panel>

    <!-- Meetings Grid -->
    <mj-collapsible-panel
        slot="after-panels"
        sectionKey="meetings"
        sectionName="Meetings"
        icon="fa fa-calendar-alt"
        variant="related-entity"
        [form]="this"
        [formContext]="formContext"
        [badgeCount]="GetSectionRowCount('meetings')"
        [defaultExpanded]="false">

        <div *ngIf="record.IsSaved">
            <mj-explorer-entity-data-grid
                [Params]="BuildRelationshipViewParamsByEntityName('Meetings','CommitteeID')"
                [NewRecordValues]="NewRecordValues('Meetings')"
                [AllowLoad]="IsSectionExpanded('meetings')"
                [ShowToolbar]="false"
                (AfterDataLoad)="SetSectionRowCount('meetings', $event.totalRowCount)">
            </mj-explorer-entity-data-grid>
        </div>
    </mj-collapsible-panel>

    <!-- Terms Grid -->
    <mj-collapsible-panel
        slot="after-panels"
        sectionKey="terms"
        sectionName="Terms"
        icon="fa fa-calendar-check"
        variant="related-entity"
        [form]="this"
        [formContext]="formContext"
        [badgeCount]="GetSectionRowCount('terms')"
        [defaultExpanded]="false">

        <div *ngIf="record.IsSaved">
            <mj-explorer-entity-data-grid
                [Params]="BuildRelationshipViewParamsByEntityName('Terms','CommitteeID')"
                [NewRecordValues]="NewRecordValues('Terms')"
                [AllowLoad]="IsSectionExpanded('terms')"
                [ShowToolbar]="false"
                (AfterDataLoad)="SetSectionRowCount('terms', $event.totalRowCount)">
            </mj-explorer-entity-data-grid>
        </div>
    </mj-collapsible-panel>

    <!-- Action Items Grid -->
    <mj-collapsible-panel
        slot="after-panels"
        sectionKey="actionItems"
        sectionName="Action Items"
        icon="fa fa-tasks"
        variant="related-entity"
        [form]="this"
        [formContext]="formContext"
        [badgeCount]="GetSectionRowCount('actionItems')"
        [defaultExpanded]="false">

        <div *ngIf="record.IsSaved">
            <mj-explorer-entity-data-grid
                [Params]="BuildRelationshipViewParamsByEntityName('Action Items','CommitteeID')"
                [NewRecordValues]="NewRecordValues('Action Items')"
                [AllowLoad]="IsSectionExpanded('actionItems')"
                [ShowToolbar]="false"
                (AfterDataLoad)="SetSectionRowCount('actionItems', $event.totalRowCount)">
            </mj-explorer-entity-data-grid>
        </div>
    </mj-collapsible-panel>

    <!-- Documents/Artifacts Grid -->
    <mj-collapsible-panel
        slot="after-panels"
        sectionKey="artifacts"
        sectionName="Documents"
        icon="fa fa-file-alt"
        variant="related-entity"
        [form]="this"
        [formContext]="formContext"
        [badgeCount]="GetSectionRowCount('artifacts')"
        [defaultExpanded]="false">

        <div *ngIf="record.IsSaved">
            <mj-explorer-entity-data-grid
                [Params]="BuildRelationshipViewParamsByEntityName('Artifacts','CommitteeID')"
                [NewRecordValues]="NewRecordValues('Artifacts')"
                [AllowLoad]="IsSectionExpanded('artifacts')"
                [ShowToolbar]="false"
                (AfterDataLoad)="SetSectionRowCount('artifacts', $event.totalRowCount)">
            </mj-explorer-entity-data-grid>
        </div>
    </mj-collapsible-panel>

</mj-record-form-container>